<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulse Threads | Checkout</title>
    <link rel="stylesheet" href="css/cartPage.css">
    <link rel="stylesheet" href="css/checkoutPage.css">
    <script src="js/auth-guard.js"></script>
</head>
<body>
    <header class="site-header">
        <div class="logo">Pulse Threads</div>
        <nav class="main-nav">
            <a href="index.html">Home</a>
            <a href="mens.html">Mens</a>
            <a href="womens.html">Womens</a>
            <a href="kids.html">Kids</a>
            <a href="discounts.html">Discounts</a>
        </nav>
        <a class="favorites-link" href="favorites.html">Favorites</a>
        <a class="cart" href="cart.html">
            Cart <span data-cart-count aria-live="polite">0</span>
        </a>
    </header>

    <main>
        <section class="page-hero">
            <h1>Checkout</h1>
            <p>Review your order and complete your purchase.</p>
        </section>

        <div class="checkout-container">
            <section class="checkout-items">
                <h2>Order Summary</h2>
                <ul id="checkout-items-list" class="checkout-items-list"></ul>
                <div class="checkout-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">$0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping:</span>
                        <span id="shipping">$0.00</span>
                    </div>
                    <div class="summary-row total-row">
                        <span>Total:</span>
                        <span id="total-amount">$0.00</span>
                    </div>
                </div>
            </section>

            <section class="checkout-form">
                <h2>Shipping Information</h2>
                <form id="checkout-form">
                    <div class="form-group">
                        <label for="full-name">Full Name</label>
                        <input type="text" id="full-name" name="fullName" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Street Address</label>
                        <input type="text" id="address" name="address" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">City</label>
                            <input type="text" id="city" name="city" required>
                        </div>
                        <div class="form-group">
                            <label for="zip">ZIP Code</label>
                            <input type="text" id="zip" name="zip" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="country">Country</label>
                        <input type="text" id="country" name="country" required>
                    </div>
                    <button type="submit" class="place-order-btn">Place Order</button>
                </form>
            </section>
        </div>

        <div id="empty-checkout" class="empty-checkout" style="display:none;">
            <p>Your cart is empty.</p>
            <a href="index.html" class="cta-link">Start Shopping</a>
        </div>
    </main>

    <footer>
        <p>Â© 2025 Pulse Threads. Secure checkout.</p>
    </footer>

    <script src="js/main.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const checkoutItemsList = document.getElementById("checkout-items-list");
            const emptyCheckout = document.getElementById("empty-checkout");
            const checkoutContainer = document.querySelector(".checkout-container");
            const subtotalEl = document.getElementById("subtotal");
            const shippingEl = document.getElementById("shipping");
            const totalAmountEl = document.getElementById("total-amount");
            const checkoutForm = document.getElementById("checkout-form");

            function renderCheckoutItems() {
                // Wait for main.js to load if needed
                if (!window.getCartState) {
                    setTimeout(renderCheckoutItems, 100);
                    return;
                }
                
                const cartState = window.getCartState();
                const PRICE_MAP = window.PRICE_MAP || {};

                if (!cartState.items || cartState.items.length === 0) {
                    checkoutContainer.style.display = "none";
                    emptyCheckout.style.display = "block";
                    return;
                }

                checkoutContainer.style.display = "grid";
                emptyCheckout.style.display = "none";
                checkoutItemsList.innerHTML = "";

                let subtotal = 0;
                cartState.items.forEach((item) => {
                    const price = item.price || PRICE_MAP[item.product] || 0;
                    subtotal += price;

                    const li = document.createElement("li");
                    let label = "";
                    if (item.category === "mens") label = "Menswear pick";
                    else if (item.category === "womens") label = "Womenswear pick";
                    else if (item.category === "kids") label = "Kidswear pick";
                    else if (item.category === "discount") label = "Discount deal";
                    else label = "Fresh drop";

                    li.innerHTML = `
                        <div class="checkout-item-info">
                            <span class="checkout-product-name">${item.product}</span>
                            <span class="checkout-product-label">${label}</span>
                        </div>
                        <span class="checkout-product-price">$${price.toFixed(2)}</span>
                    `;
                    checkoutItemsList.appendChild(li);
                });

                const shipping = subtotal > 0 ? 9.99 : 0;
                const total = subtotal + shipping;

                subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
                shippingEl.textContent = shipping > 0 ? `$${shipping.toFixed(2)}` : "Free";
                totalAmountEl.textContent = `$${total.toFixed(2)}`;
            }

            checkoutForm.addEventListener("submit", (e) => {
                e.preventDefault();
                
                const formData = new FormData(checkoutForm);
                const orderData = {
                    items: window.getCartState().items,
                    shipping: {
                        name: formData.get("fullName"),
                        email: formData.get("email"),
                        phone: formData.get("phone"),
                        address: formData.get("address"),
                        city: formData.get("city"),
                        zip: formData.get("zip"),
                        country: formData.get("country")
                    },
                    total: parseFloat(totalAmountEl.textContent.replace("$", "")),
                    date: new Date().toISOString()
                };

                // Store order (in a real app, this would be sent to a server)
                localStorage.setItem("lastOrder", JSON.stringify(orderData));
                
                // Clear cart
                localStorage.setItem("pulseThreadsCart", JSON.stringify({ count: 0, items: [] }));
                
                // Redirect to order confirmation
                window.location.href = "order-confirmation.html";
            });

            renderCheckoutItems();
        });
    </script>
</body>
</html>

